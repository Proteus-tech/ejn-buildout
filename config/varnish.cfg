[buildout]
parts +=
   varnish-build
   varnish-configuration
   varnish

[config]
varnish-address = 127.0.0.1:8099
varnish-backend-port = 8095

[varnish-build]
recipe = plone.recipe.varnish:build
url = https://varnish-cache.org/_downloads/varnish-3.0.7.tgz

[varnish-configuration]
recipe = plone.recipe.varnish:configuration
backends = 127.0.0.1:8095

[varnish]
recipe = plone.recipe.varnish:script
cache-size = 512M
cache-type = malloc
mode = foreground
daemon = ${varnish-build:location}/sbin/varnishd
input = ${buildout:directory}/templates/varnish.vcl.in
output = ${buildout:directory}/parts/varnish-configuration/varnish.vcl
config = ${varnish-configuration:output}
backend-port = ${config:varnish-backend-port}
backends = 127.0.0.1:8095
bind = ${config:varnish-address}
mode = foreground
runtime-parameters =
    sess_workspace=32768
    thread_pool_add_delay=2
    thread_pool_min=10
    thread_pool_max=200
    thread_pools=2
    default_ttl=120
    cli_timeout=60
    http_resp_hdr_len=65536
    http_resp_size=98304

