[buildout]
parts +=
   varnish-build
   varnish-configuration
   varnish

[config]
varnish-address = 127.0.0.1:8099
varnish-backend-port = 8095

[varnish-build]
recipe = plone.recipe.varnish:build
url = https://varnish-cache.org/_downloads/varnish-3.0.7.tgz

[varnish-configuration]
recipe = plone.recipe.varnish:configuration
backends = 127.0.0.1:8095
input = ${buildout:directory}/templates/varnish.vcl.in
output = ${buildout:directory}/etc/varnish.vcl

[varnish]
recipe = plone.recipe.varnish:script
cache-size = 512M
cache-type = malloc
mode = foreground
daemon = ${varnish-build:location}/sbin/varnishd
config = ${varnish-configuration:output}
backend-port = ${config:varnish-backend-port}
backends = 127.0.0.1:8095
bind = ${config:varnish-address}
mode = foreground

